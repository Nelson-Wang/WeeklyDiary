月度总结
——2020年9月  
2020年9月的主要工作还是在写自动化用例，了解了VxLAN特性相关知识，现对此主题展开描述。
1. VxLAN是什么?
VxLAN 全称是 Visual Extensible Local Area Network（虚拟扩展本地局域网）VxLAN 本质上是一种隧道封装技术。从名字上就知道，这是一个 VLAN 的扩展协议。它使用 TCP/IP 协议栈的惯用手法——封装/解封装技术，将 L2 的以太网帧封装成 L4 的 UDP 数据报，然后在 L3 的网络中传输，效果就像 L2 的以太网帧在一个广播域中传输一样，实际上是跨越了 L3 网络，但却感知不到 L3 网络的存在。
2. 为什么要用VxLAN
随着网络技术的发展，云计算凭借其在系统利用率高、人力/管理成本低、灵活性/可扩展性强等方面表现出的优势，已经成为目前企业IT建设的新趋势。而服务器虚拟化作为云计算的核心技术之一，得到了越来越多的应用。服务器虚拟化后，一台物理服务器中承载了多台虚拟机，每个虚拟机都有独立的IP地址和MAC地址，相当于接入数据中心的服务器成倍扩大了，因而传统的二层网络环境已不能满足如此大量的需求。其存在的问题总结为以下两点。
● 网络隔离能力有限
VLAN作为当前主流的网络隔离技术，在标准定义中只有12比特，因此可用的VLAN数量仅4096个。对于公有云或其它大型虚拟化云计算服务这种动辄上万甚至更多租户的场景而言，VLAN的隔离能力无法满足。VXLAN引入了类似VLAN ID的用户标识，称为VXLAN网络标识VNI（VXLAN Network Identifier），由24比特组成，支持多达16M的VXLAN段，有效得解决了云计算中海量租户隔离的问题。
● 虚拟机迁移范围受限
由于服务器资源等问题（如CPU过高，内存不够等），虚拟机迁移已经成为了一个常态性业务。
虚拟机迁移是指将虚拟机从一个物理机迁移到另一个物理机。为了保证虚拟机迁移过程中业务不中断，则需要保证虚拟机的IP地址、MAC地址等参数保持不变，这就要求虚拟机迁移必须发生在一个二层网络中。而传统的二层网络，将虚拟机迁移限制在了一个较小的局部范围内。VXLAN将VM发出的原始报文进行封装后通过VXLAN隧道进行传输，隧道两端的VM不需感知传输网络的物理架构。这样，对于具有同一网段IP地址的VM而言，即使其物理位置不在同一个二层网络中，但从逻辑上看，相当于处于同一个二层域。即VXLAN技术在三层网络之上，构建出了一个虚拟的大二层网络，只要虚拟机路由可达，就可以将其规划到同一个大二层网络中。这就解决了虚拟机迁移范围受限问题。
3. VXLAN报文格式
● VXLAN Header
增加VXLAN头，其中包含24比特的VNI字段，用来定义VXLAN网络中不同的租户。此外，还包含VXLAN Flags和两个保留字段。
● UDP Header
VXLAN头和原始以太帧一起作为UDP的数据。UDP头中，目的端口号
固定为4789，源端口号是原始以太帧通过哈希算法计算后的值。
● Outer IP Header
封装外层IP头。其中，源IP地址为源VM所属VTEP的IP地址，目的IP地址为目的VM所属VTEP的IP地址。
● Outer MAC Header
封装外层以太头。其中，源MAC地址为源VM所属VTEP的MAC地址，目的MAC地址为到达目的VTEP的路径中下一跳设备的MAC地址。
 
 
 
 
